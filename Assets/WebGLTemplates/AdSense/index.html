<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="assets/css/reset.css">
  <link rel="stylesheet" href="assets/css/style.css">

  <title>{{{ PRODUCT_NAME }}}</title>
  <script async src="https://html5gameportal.com/embeds/wortal-1.1.2.js"></script>
  <script>
      window.addEventListener("load", () => {
          window.initWortal(function () {
              console.log("Wortal setup complete!");
              setTimeout(() => {
                  window.triggerWortalAd("preroll", "Load Game", {
                      adBreakDone: function () {
                          console.log("AdBreakDone reached.");
                          // Render game on adBreakDone.
                      }
                  });
              }, 100);
          });
      });
  </script>
</head>
<body>
<div class="webgl-wrapper">
  <div class="webgl-content">
    <div id="progress" class="progress Dark">
      <div class="empty">
        <div id="progressBar" class="full"></div>
      </div>
    </div>
    <div id="unityContainer">
      <canvas id="unity-canvas" style="background: {{{ BACKGROUND_FILENAME ? 'url(\'Build/' + BACKGROUND_FILENAME.replace(/'/g, '%27') + '\') center / cover' : BACKGROUND_COLOR }}}"></canvas>
    </div>
  </div>
</div>

<script src="MyLoader.js"></script>
<script>
    createUnityInstance(
        document.querySelector("#unity-canvas"),
        {
            dataUrl: "Build/{{{ DATA_FILENAME }}}",
            frameworkUrl: "Build/{{{ FRAMEWORK_FILENAME }}}",
            codeUrl: "Build/{{{ CODE_FILENAME }}}",
            #if MEMORY_FILENAME
            memoryUrl: "Build/{{{ MEMORY_FILENAME }}}",
            #endif
            #if SYMBOLS_FILENAME
            symbolsUrl: "Build/{{{ SYMBOLS_FILENAME }}}",
            #endif
            streamingAssetsUrl: "StreamingAssets",
            companyName: "{{{ COMPANY_NAME }}}",
            productName: "{{{ PRODUCT_NAME }}}",
            productVersion: "{{{ PRODUCT_VERSION }}}",
        },
        unityProgress).then((unityInstance) => {
        myGameInstance = unityInstance;
    });

    function unityProgress(progress) {
        if (progress === 1) {
            document.querySelector('#progress').style.display = 'none';
            return;
        }
        if (progress > 0) {
            document.querySelector('#progressBar').style.width = 100 * progress + '%';
            document.querySelector('#progressBar').style.display = 'inherit';
        }
    }
</script>
<script>
    var showRewardedAdFn;
    function showInterstitialAd(type, name) {
        adBreak({
            type: type,
            name: name,
            beforeAd: () => {
                myGameInstance.Module.asmLibraryArg._TriggerBeforeAd();
            },
            afterAd: () => {
                myGameInstance.Module.asmLibraryArg._TriggerAfterAd();
            },
            adBreakDone: (placementInfo) => {
                myGameInstance.Module.asmLibraryArg._TriggerAdBreakDone();
            },
        });
    }
    function showRewardedAd(name) {
        adBreak({
            type: 'reward',
            name: name,
            beforeAd: () => {
                myGameInstance.Module.asmLibraryArg._TriggerBeforeAd();
            },
            afterAd: () => {
                myGameInstance.Module.asmLibraryArg._TriggerAfterAd();
            },
            adBreakDone: (placementInfo) => {
                myGameInstance.Module.asmLibraryArg._TriggerAdBreakDone();
            },
            beforeReward: (showAdFn) => {
                showRewardedAdFn = showAdFn;
                myGameInstance.Module.asmLibraryArg._TriggerBeforeReward();
            },
            adDismissed: () => {
                myGameInstance.Module.asmLibraryArg._TriggerAdDismissed();
            },
            adViewed: () => {
                myGameInstance.Module.asmLibraryArg._TriggerAdViewed();
            },
        });
    }
    function triggerShowRewardedAdFn() {
        console.log("***** triggerShowRewardedAdFn *****");
        showRewardedAdFn();
    }
</script>
<!-- check for F key press to toggle full screen -->
<script>
    var isFullscreen = false;

    document.addEventListener('keydown', function(event) {
        if (event.which === 70) {
            if (!isFullscreen) {
                myGameInstance.SetFullscreen(1);
            } else {
                myGameInstance.SetFullscreen(0);
            }
            isFullscreen = !isFullscreen;
        }
    });
</script>
</body>
</html>
